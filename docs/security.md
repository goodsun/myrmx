# セキュリティガイド

siegeNgin Browser Deploy Toolのセキュリティ機能と考慮事項について説明します。

## 実装済みセキュリティ機能

### 1. パストラバーサル対策

プロジェクト名の厳格な検証により、ディレクトリトラバーサル攻撃を防止します。

**検証ルール:**
- 使用可能文字: `a-zA-Z0-9_-`のみ
- 危険なパターンの拒否: `..`, `/`, `\`, `~`等
- パスの正規化とprojectsディレクトリ外へのアクセス防止

**実装箇所:**
- サーバー側: `validateProjectName()`, `validateProjectPath()`
- クライアント側: `isValidProjectName()`

### 2. ネットワーク検証

接続中のネットワークを識別し、メインネットでの誤操作を防止します。

**対応ネットワーク:**
- Ethereum Mainnet (警告表示)
- Goerli/Sepolia Testnet
- Polygon Mainnet (警告表示)
- Mumbai Testnet
- Localhost/Hardhat

**警告表示:**
- メインネット接続時に赤色で警告
- ガス見積もりダイアログでも再度警告

### 3. 入力検証

コンストラクタ引数の型別バリデーションにより、不正な入力を防止します。

**検証内容:**
- `address`: 有効なEthereumアドレス形式
- `uint/int`: 数値範囲チェック
- `bool`: true/false選択式
- `bytes32`: 正しい長さの16進数
- 配列: 要素ごとの型チェック

### 4. CORS設定

適切なCORS設定により、不正なオリジンからのアクセスを制限します。

```javascript
// 開発環境: すべて許可
// 本番環境: 特定のオリジンのみ
const allowedOrigins = process.env.NODE_ENV === 'production' 
    ? ['https://yourdomain.com'] 
    : true;
```

## セキュリティベストプラクティス

### 1. 秘密鍵の管理
- 秘密鍵は**絶対に**サーバーに送信されません
- すべての署名はMetaMask内で実行されます
- ニーモニックやプライベートキーの入力欄はありません

### 2. トランザクション承認
- すべてのトランザクションはMetaMaskで承認が必要
- ガス料金の事前確認
- キャンセル可能な確認ダイアログ

### 3. プロジェクトの独立性
- 各プロジェクトは独立した環境で実行
- プロジェクト間でのアクセスは不可
- クリーンアップ機能で機密情報を含む可能性のあるファイルを削除可能

## 推奨事項

### 本番環境での使用
1. CORS設定で特定のドメインのみ許可
2. HTTPS接続の強制
3. レート制限の実装
4. アクセスログの記録

### 開発環境での使用
1. ローカルネットワークのみで使用
2. テストネットでの十分な検証
3. 本番用ウォレットとの分離

## 既知の制限事項

1. **ファイルシステムアクセス**
   - サーバーはprojectsディレクトリ内のファイルにアクセス可能
   - 信頼できないプロジェクトは配置しない

2. **コマンド実行**
   - npm installとhardhat compileを実行
   - 悪意のあるpackage.jsonスクリプトに注意

3. **依存関係**
   - npm installは自動実行される
   - 信頼できない依存関係を含むプロジェクトに注意

## インシデント対応

セキュリティ問題を発見した場合:
1. 直ちに使用を停止
2. 影響範囲の確認
3. GitHubのIssueで報告（機密情報は含めない）

## 今後の改善予定

- [ ] CSRFトークンの実装
- [ ] レート制限
- [ ] 監査ログ機能
- [ ] サンドボックス環境での実行