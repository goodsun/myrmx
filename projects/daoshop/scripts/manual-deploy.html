<!DOCTYPE html>
<html>
<head>
    <title>Manual Deploy</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>Manual Deploy for Private Network</h1>
    <button onclick="deploy()">Deploy with Legacy Transaction</button>
    <div id="result"></div>

    <script>
        async function deploy() {
            try {
                await ethereum.request({ method: 'eth_requestAccounts' });
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                
                // ABIとバイトコードを設定
                const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"}];
                const bytecode = "0x608060405234801561001057600080fd5b5060405180604001604052806007815260200166044414f53686f760cc1b81525060405180604001604052806004815260200163053484f560e41b81525081600090816200006091906200018d565b5060016200006f82826200018d565b5050506200008c620000866200009260201b60201c565b62000096565b62000259565b3390565b600780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b634e487b7160e01b600052604160045260246000fd5b600181811c908216806200011357607f821691505b6020821081036200013457634e487b7160e01b600052602260045260246000fd5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620001ac7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200016d565b620001b886836200016d565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b600062000205620001ff620001f984620001d0565b620001da565b620001d0565b9050919050565b6000819050919050565b6200022183620001e4565b6200023962000230826200020c565b8484546200017a565b825550505050565b600090565b6200025062000241565b6200025d81848462000216565b505050565b5b8181101562000285576200027960008262000246565b60018101905062000263565b5050565b601f821115620002d4576200029e8162000148565b620002a9846200015d565b81016020851015620002b9578190505b620002d1620002c8856200015d565b83018262000262565b50505b505050565b600082821c905092915050565b6000620002f960001984600802620002d9565b1980831691505092915050565b6000620003148383620002e6565b9150826002028217905092915050565b6200032f82620000aa565b67ffffffffffffffff8111156200034b576200034a620000b5565b5b62000357825462000113565b6200036482828562000289565b600060209050601f8311600181146200039c576000841562000387578287015190505b62000393858262000306565b86555062000403565b601f198416620003ac8662000148565b60005b82811015620003d657848901518255600182019150602085019450602081019050620003af565b86831015620003f65784890151620003f2601f891682620002e6565b8355505b6001600288020188555050505b505050505050565b612e32806200041c6000396000f3fe"; // 短縮版
                
                const factory = new ethers.ContractFactory(abi, bytecode, signer);
                
                // レガシートランザクションで送信
                const contract = await factory.deploy({
                    gasLimit: 5000000,
                    gasPrice: ethers.utils.parseUnits("50", "gwei"),
                    type: 0 // レガシートランザクション
                });
                
                document.getElementById('result').innerHTML = `
                    <p>Transaction sent: ${contract.deployTransaction.hash}</p>
                    <p>Waiting for confirmation...</p>
                `;
                
                await contract.deployed();
                
                document.getElementById('result').innerHTML = `
                    <p>Contract deployed at: ${contract.address}</p>
                `;
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <p style="color: red;">Error: ${error.message}</p>
                `;
                console.error(error);
            }
        }
    </script>
</body>
</html>